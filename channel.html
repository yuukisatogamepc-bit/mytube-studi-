<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チャンネル - iroTube</title>
    <style>
        body { font-family: sans-serif; margin: 0; background: #fff; text-align: center; }
        .header { padding: 40px 20px; border-bottom: 1px solid #eee; }
        .c-icon { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; background: #eee; }
        .c-name { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .v-grid { display: flex; flex-wrap: wrap; gap: 15px; padding: 20px; justify-content: center; }
        .v-card { width: 200px; text-decoration: none; color: #000; text-align: left; }
        .thumb { width: 100%; aspect-ratio: 16/9; background: #eee; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body>

<div class="header">
    <img id="chIcon" class="c-icon" src="">
    <div id="chName" class="c-name">読み込み中...</div>
</div>

<h3>投稿動画</h3>
<div class="v-grid" id="vGrid"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAZivYKOGc1tSUAIDq_c10C1wJ-Pdh0U2o",
        authDomain: "mytube-f4544.firebaseapp.com",
        projectId: "mytube-f4544",
        storageBucket: "mytube-f4544.firebasestorage.app",
        messagingSenderId: "655444283107",
        appId: "1:655444283107:web:04f9173faf2d951790ffd6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const params = new URLSearchParams(window.location.search);
    const targetUid = params.get("id"); // URLの ?id= から取得

    if (targetUid) {
        // 1. そのユーザーの情報を取得
        getDoc(doc(db, "users", targetUid)).then(uSnap => {
            if (uSnap.exists()) {
                const ud = uSnap.data();
                document.getElementById('chName').innerText = ud.name;
                document.getElementById('chIcon').src = ud.icon || "";
            }
        });

        // 2. そのユーザーが投稿した動画だけを表示
        const q = query(collection(db, "videos"), where("userId", "==", targetUid));
        getDocs(q).then(snap => {
            const grid = document.getElementById('vGrid');
            grid.innerHTML = "";
            snap.forEach(doc => {
                const v = doc.data();
                grid.innerHTML += `
                    <a href="watch.html?id=${doc.id}" class="v-card">
                        <img class="thumb" src="${v.thumbnail || ''}">
                        <div style="font-weight:bold; margin-top:5px;">${v.title}</div>
                    </a>`;
            });
        });
    }
</script>
</body>
</html>
