<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTube - チャンネル</title>
    <style>
        body { font-family: sans-serif; background: #f9f9f9; margin: 0; }
        header { display: flex; align-items: center; padding: 10px 20px; background: white; border-bottom: 1px solid #ddd; }
        .logo { color: red; font-size: 24px; font-weight: bold; cursor: pointer; text-decoration: none; }
        .channel-header { padding: 30px 20px; display: flex; align-items: center; gap: 20px; background: white; border-bottom: 1px solid #eee; }
        .c-icon-l { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; }
        #videoGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; padding: 20px; }
        .v-card { cursor: pointer; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .v-thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; background: #000; }
        .v-title { font-weight: bold; font-size: 14px; padding: 10px; }
    </style>
</head>
<body>
<header><a href="index.html" class="logo">MyTube</a></header>
<div class="channel-header">
    <img src="" class="c-icon-l" id="hIcon">
    <div>
        <h2 id="hName" style="margin:0;">読み込み中...</h2>
        <div id="hSubs" style="color:#606060; font-size:14px; margin-top:5px;">登録者 0人</div>
    </div>
</div>
<div id="videoGrid"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { /* 上記と同じConfig */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const uid = new URLSearchParams(window.location.search).get('uid');

    if (uid) {
        onSnapshot(doc(db, "users", uid), snap => {
            const d = snap.data();
            document.getElementById('hName').innerText = d.name;
            document.getElementById('hIcon').src = d.icon || "";
            document.getElementById('hSubs').innerText = `登録者 ${(d.subCount || 0).toLocaleString()}人`;
        });

        onSnapshot(query(collection(db, "videos"), where("userId", "==", uid)), snap => {
            const grid = document.getElementById('videoGrid'); grid.innerHTML = "";
            if(snap.empty) grid.innerHTML = "動画がありません";
            snap.forEach(vDoc => {
                const vd = vDoc.data();
                const div = document.createElement('div'); div.className = "v-card";
                div.onclick = () => location.href = `watch.html?id=${vDoc.id}`;
                div.innerHTML = `<img src="${vd.thumbnail || 'https://via.placeholder.com/240x135?text=No+Image'}" class="v-thumb"><div class="v-title">${vd.title}</div>`;
                grid.appendChild(div);
            });
        });
    }
</script>
</body>
</html>
